CREATE KEYSPACE ChicagoErp  WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };
CREATE TABLE IF NOT EXISTS ChicagoErp.Users (
    email varchar PRIMARY KEY,
    id uuid,
    password_hash varchar,
    password_salt blob,
    avatar blob,
    first_name varchar,
    middle_name varchar,
    last_name varchar,
    phone varchar,
    holding_id uuid,
    company_id uuid,
    branch_id uuid,
    roles set<varchar>,
    extra_permissions set<varchar>,
    create_datetime timestamp);

CREATE TABLE IF NOT EXISTS ChicagoErp.Holdings (
    id uuid PRIMARY KEY,
    name varchar,
    companies set<uuid>,
    description varchar,
    create_datetime timestamp);

CREATE TABLE IF NOT EXISTS ChicagoErp.Companies(
    id uuid PRIMARY KEY,
    holding_id uuid,
    name varchar,
    brnches set<uuid>,
    description varchar,
    create_datetime timestamp);

CREATE TABLE IF NOT EXISTS ChicagoErp.Branches(
    id uuid PRIMARY KEY,
    company_id uuid,
    name varchar,
    description varchar,
    create_datetime timestamp);

CREATE TABLE IF NOT EXISTS ChicagoErp.Permissions (
    permission varchar PRIMARY KEY,
    description varchar);
INSERT INTO ChicagoErp.Permissions (permission, description) VALUES('create_user', 'Can create new users');
INSERT INTO ChicagoErp.Permissions (permission, description) VALUES('delete_user', 'Can delete existing users');
INSERT INTO ChicagoErp.Permissions (permission, description) VALUES('add_branch', 'Can add new branch into company');
INSERT INTO ChicagoErp.Permissions (permission, description) VALUES('add_company', 'Can add new company into holding');
INSERT INTO ChicagoErp.Permissions (permission, description) VALUES('add_holding', 'Can add new holding');

CREATE TABLE IF NOT EXISTS ChicagoErp.Roles (
    role varchar PRIMARY KEY,
    permissions set<varchar>,
    description varchar);
INSERT INTO ChicagoErp.Roles (role, permissions, description) VALUES('holding_admin',
{'create_user', 'delete_user', 'add_holding', 'add_company', 'add_branch'}, 'Holding level admin');
INSERT INTO ChicagoErp.Roles (role, permissions, description) VALUES('company_admin',
{'create_user', 'delete_user', 'add_holding', 'add_company', 'add_branch'}, 'Company level admin');
INSERT INTO ChicagoErp.Roles (role, permissions, description) VALUES('branch_admin',
{'create_user', 'delete_user'}, 'Branch level admin');

CREATE TABLE IF NOT EXISTS ChicagoErp.Customers ();
